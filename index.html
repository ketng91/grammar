<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Học Grammar - Lớp Anh thầy Kết</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body {
  font-family: Arial, sans-serif;
  background-color: #fff8f0;
  margin: 0;
  padding: 0;
  text-align: center;
  padding-bottom: 110px;
}
body {
  padding-bottom: 110px; /* hoặc tuỳ chỉnh theo ý muốn */
}


#vnSentence {
  color: #4b6b3b;        /* xanh lá vintage */
  font-weight: bold;      /* in đậm */
  font-size: 22px;        /* cỡ chữ lớn */
  margin-bottom: 20px;    /* thêm khoảng cách dưới */
}

#fullAnswer {
  width: 93%;               /* bằng width của #vnSentence */
  font-size: 22px;           /* cỡ chữ vừa nhìn */
  font-family: 'Arial', sans-serif; /* kiểu chữ bạn muốn */
  height: 80px;              /* giữ cao phù hợp */
  text-align: center;  
  margin-top: 10px;          /* khoảng cách trên */
  margin-bottom: 20px;       /* khoảng cách dưới */
  padding: 8px;
  box-sizing: border-box;    /* bao gồm padding trong width */
  border-radius: 10px;
  border: 3px solid #ccc;
}


#submitBtn,
#changeBtn {
  font-size: 18px;          /* chữ to hơn */
  padding: 12px 25px;       /* padding ngang đủ cho chữ */
  min-width: 160px;         /* đảm bảo nút đủ rộng */
  white-space: nowrap;      /* không xuống dòng */
  margin: 10px 5px;
  cursor: pointer;
  border-radius: 8px;
  border: none;
  background-color: #a0e7e5;
  transition: background-color 0.25s ease, transform 0.2s ease;
}

#submitBtn:hover,
#changeBtn:hover,
#submitBtn:active,
#changeBtn:active {
  background-color: #ffb3ba;
  transform: translateY(-2px);
}


/* ===== HEADER ===== */
header {
  background-color: #ffd6ba;
  padding: 15px 20px;
  font-weight: bold;
  color: #7a4e3e;
  display: flex;
  flex-wrap: wrap;       
  align-items: center;
  justify-content: space-between;  /* Left luôn bên trái, center căn giữa */
  gap: 15px;
}

/* Left: icon + home text */
.header-left {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 0 0 auto;          /* không bị co lại */
}

.header-left a {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 24px;
  color: #7a4e3e;
  text-decoration: none;
}

.header-left a i {
  font-size: 28px;
}
/* Center title */
header {
  position: relative;
}

.header-center {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  font-size: 24px;
  margin: 0;
  white-space: nowrap;
}

/* TOP SELECT */
.top-select { display: flex; justify-content: center; margin: 20px; }
select {
  padding: 8px 14px;
  font-size: 18px;
  border-radius: 8px;
  border: 2px solid #a0e7e5;
  background-color: #e3fdfd;
}

/* Grammar box */
.grammar-box {
  width: 85%;
  margin: 20px auto;
  background-color: #d0f0fd;  /* xanh nhạt */
  border-radius: 10px;
  padding: 20px;
  text-align: left;
  font-size: 20px;
  line-height: 1.6;
}

/* ===== Khung xem Google Drive ===== */
.drive-box {
  width: 90%;
  margin: 20px auto;
  background-color: #d0e7ff;  /* màu xanh nhạt */
  border-radius: 12px;
  padding: 10px;
}
.drive-box iframe {
  width: 100%;
  height: 500px;
  border-radius: 10px;
}

/* Bài tập điền từ */
.section-title { font-size: 26px; font-weight: bold; margin: 20px 0 10px 0; }
.exercise, .translation-exercise { width: 80%; margin: 0 auto 30px auto; font-size: 22px; text-align: left; }
.exercise input, .translation-exercise input {
  width: 220px;
  font-size: 20px;
  padding: 5px;
  margin-left: 10px;
  border-radius: 6px;
}
.exercise button, .translation-exercise button {
  margin-left: 10px;
  padding: 6px 12px;
  font-size: 18px;
  background-color: #a0e7e5;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}
.exercise button:hover, .translation-exercise button:hover { background-color: #ffb3ba; }
.result { font-weight: bold; color: #C5705D; font-size: 20px; margin-left: 10px; }

/* ===== VẬN DỤNG VIẾT CÂU ===== */
.sentence-box {
  background-color: #ffe0f0; 
  border: 2px solid #ffb3d9;
  border-radius: 12px;
  padding: 15px 20px;
  font-size: 28px;           /* cỡ chữ lớn */
  font-weight: bold;          /* in đậm */
  color: #4b6b3b;            /* xanh lá vintage */
  text-align: center;
  margin: 20px auto;
  width: 90%;
  min-height: 120px;          /* cố định chiều cao tối thiểu */
  display: flex;
  align-items: center;        /* căn giữa theo chiều dọc */
  justify-content: center;    /* căn giữa ngang */
  box-sizing: border-box;
  word-wrap: break-word;      /* xuống dòng nếu quá dài */
}
.input-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  justify-content: flex-start; /* vẫn căn lề trái */
  flex-wrap: wrap;
  margin-left: 140px; /* dịch vào từ lề trái */
}

.input-row input {
  padding: 6px;
  width: 300px; /* cố định chiều rộng */
  font-size: 22px;
  border: 1px solid #ccc;
  border-radius: 4px;
  flex-shrink: 0; /* không bị co lại */
}

.input-row button {
  width: 100px; /* cố định button */
  padding: 6px 10px;
  font-size: 18px;
  flex-shrink: 0;
}

.input-row .result {
  min-width: 120px; /* khung hiển thị kết quả cố định */
  display: inline-block;
}
.arrow-icon { font-size: 18px; font-weight: bold; }
.correct { color: green; font-weight: bold; font-size: 18px; }
.wrong { color: red; font-weight: bold; font-size: 18px; }

.full-answer-box { width: 95%; max-width: 100%; height: 100px; padding: 8px; font-size: 25px; color: blue; border-radius: 10px; border: 5px solid #ccc; box-sizing: border-box; }
.full-submit { padding: 10px 12px; margin-top: 10px;}

button { padding: 8px 0; margin-right: 10px; cursor: pointer; border-radius: 5px; border: none; background-color: #a0e7e5; font-size: 16px; width: 140px; transition: background-color 0.25s ease, transform 0.2s ease; }
button:hover, button:active { background-color: #ffb3ba; transform: translateY(-2px); }

.signature {
  font-size: 18px;
  font-style: italic;
  font-weight: bold;
  color: #004aad;
  text-align: right;        /* vẫn phải căn phải */
  margin-top: -25px;
  margin-right: 50px;       /* dịch vào trái 50px */
}

.confetti {
  position: fixed;
  top: 50%;
  left: 50%;
  width: 8px;
  height: 8px;
  background: red;
  border-radius: 50%;
  pointer-events: none;
  opacity: 0.9;
  animation: pop 1s ease-out forwards;
  z-index: 9999;
}

@keyframes pop {
  0% {
    transform: translate(0,0) scale(1);
    opacity: 1;
  }
  50% {
    transform: translate(calc(var(--x)*0.5), calc(var(--y)*0.5)) scale(1.2);
    opacity: 1;
  }
  100% {
    transform: translate(var(--x), var(--y)) scale(0.5);
    opacity: 0;
  }
}

@media (max-width: 480px) {

  header {
    padding: 10px 15px;
    flex-direction: column;
    text-align: center;
  }

  .header-left {
    width: 100%;
    justify-content: center;
    order: 1;
  }

  .header-left a {
    font-size: 18px;
  }
  .header-left a i {
    font-size: 20px;
  }

  .header-center {
    position: static;
    transform: none;
    margin-top: 5px;
    font-size: 22px;
    order: 2;
    white-space: normal;
  }

  .grammar-box,
  .drive-box,
  .exercise,
  .translation-exercise,
  .sentence-box {
    width: 95%;
    font-size: 18px;
  }

  #vnSentence { font-size: 18px; }

  #fullAnswer.full-answer-box,
.full-answer-box {
  width: 100%;
  max-width: 100% !important;   /* NGĂN TRÀN NGANG  */
  box-sizing: border-box;        /* Tính luôn border vào width */
  font-size: 18px;
  height: 80px;
}

  input,
  .exercise input,
  .translation-exercise input {
    width: 100% !important;
    margin-top: 5px;
  }

  .input-row {
    margin-left: 0;
    justify-content: center;
  }

  button,
  #submitBtn,
  #changeBtn {
    width: 100%;
    font-size: 16px;
    margin: 6px 0;
  }

  .signature {
    margin-top: 10px;
    margin-right: 10px;
    font-size: 16px;
    text-align: center;
  }
}
</style></head>

<body>

<header>
  <div class="header-left">
    <a href="https://ketng91.github.io/lopanhthayket/">
      <i class="fa-solid fa-house"></i>
    </a>
    <span class="header-text">Lớp Anh thầy Kết</span>
  </div>
  <div class="header-center">Khoá Grammar</div>
</header>

<!-- Chọn topic -->
<div class="top-select">
  <select id="topicSelect"></select>
</div>

<!-- Lý thuyết -->
<div class="grammar-box" id="grammarContainer"></div>

<!-- Khung Google Drive -->
<div class="drive-box">
  <iframe id="driveFrame" src="" frameborder="0" allowfullscreen></iframe>
</div>

<!-- Bài tập điền từ -->
<div class="section-title">Bài tập điền từ</div>
<div class="exercise" id="exercise"></div>

<!-- Bài tập dịch câu -->
<div class="section-title">Bài tập dịch câu</div>
<div class="sentence-box" id="vnSentence"></div>
<div id="inputs"></div>
<textarea id="fullAnswer" class="full-answer-box" placeholder="Nhập câu dịch tiếng Anh..."></textarea><br>
<button id="submitBtn" class="full-submit">Submit</button>
<button id="changeBtn">Next sentence</button>
<div id="fullResult"></div>

<div class="signature">Lớp Anh thầy Kết</div>

<script>




/* ===== DATA ===== */
const grammarData = {
  "MĐQH": "Phần lý thuyết",
  "Liên từ, Adv nối": "Phần lý thuyết",
  "Rút gọn MĐ Trạng ngữ": "Phần lý thuyết",


};




const driveLinks = {
  "MĐQH": "https://docs.google.com/document/d/1c3aJf7_Gioxha_NpwOJW5d8Crfo07V5y/preview",
  "Liên từ, Adv nối": "https://docs.google.com/document/d/1AD02lk3BPPMm_BL2TP06ENhu_FdJWKkB/preview",
  "Rút gọn MĐ Trạng ngữ": "https://docs.google.com/document/d/1Qn0DOdEIg7eiyRnXGSHZLe3LTsxN1g_T/preview",

};






const exercises = {
  "MĐQH":[
  {q: "The scientist _____ won the Nobel Prize is giving a lecture today.", a: "who"},
  {q: "The house _____ roof was damaged in the storm has been repaired.", a: "whose"},
  {q: "The candidates _____ we interviewed yesterday were all very well-qualified.", a: ["who", "whom"]},
  {q: "Sustainable energy, _____ is becoming more affordable, helps reduce carbon emissions.", a: "which"},
  {q: "I am looking for a colleague _____ specializes in environmental law.", a: "who"},
  {q: "The city _____ I grew up in has changed significantly over the last decade.", a: "which"},
  {q: "Students _____ assignments are submitted late will lose 10% of their grade.", a: "whose"},
  {q: "This is the most innovative solution _____ has been proposed so far.", a: "that"},
  {q: "The person to _____ you should send the application is the HR Manager.", a: "whom"},
  {q: "Electric cars, _____ produce zero tailpipe emissions, are key to cleaner air.", a: "which"}
  ],
  "Liên từ, Adv nối":[
  {q: "______ digital technology has advanced, many remote areas still lack internet access.", a: "While"},
  {q: "The experiment failed; ______, the data collected provided valuable insights.", a: "nevertheless"},
  {q: "Students must submit their assignments by Friday, ______ they will face a grade penalty.", a: "otherwise"},
  {q: "______ the high cost of tuition, many students apply for international scholarships.", a: "Despite"},
  {q: "The city's infrastructure is aging; ______, the population is growing rapidly.", a: "furthermore"},
  {q: "______ the results were inconclusive, the researchers decided to repeat the trial.", a: "Since"},
  {q: "The theory is widely accepted ______ there is little empirical evidence to support it.", a: "even though"},
  {q: "Organic farming avoids synthetic pesticides; ______, it is often more labor-intensive.", a: "consequently"},
  {q: "The university offers a wide range of courses ______ students can explore various fields.", a: "so that"},
  {q: "______ global temperatures rise, polar ice caps continue to melt at an alarming rate.", a: "As"}
 ],
  "Rút gọn MĐ Trạng ngữ":[
  {q: "______ (conduct) the experiment multiple times, the researchers finally achieved consistent results.", a: "Having conducted"},
  {q: "When ______ (face) with the choice of two careers, she decided to pursue environmental science.", a: "faced"},
  {q: "______ (Concern) by the lack of prior research, the professor decided to start a new pilot study.", a: "Concerned"},
  {q: "While ______ (analyse) the data, the software identified several significant anomalies.", a: "analysing"},
  {q: "______ (Recognise) as a pioneer in her field, Dr. Miller was invited to speak at the global summit.", a: "Recognised"},
  {q: "After ______ (complete) the literature review, the student began writing the first chapter.", a: "completing"},
  {q: "Although ______ (reject) by many critics at first, the new theory eventually gained widespread support.", a: "rejected"},
  {q: "______ (Come) from a reputable source, the information was deemed reliable for the thesis.", a: "Coming"},
  {q: "Once ______ (introduce) to the public, the government's new education policy sparked intense debate.", a: "introduced"},
  {q: "______ (Understand) the potential risks involved, the team took extra precautions during the trial.", a: "Understanding"},
 ],






};

const dataByTopic = {
  "MĐQH":[
{
    vn: "Học sinh du học thường phát triển tính tự lập và khả năng thích nghi cao hơn.",
    parts: [
      {en: "study abroad", vn: "du học", color: "green"},
      {en: "independence", vn: "tính tự lập", color: "orange"},
      {en: "adaptability", vn: "khả năng thích nghi", color: "purple"}
    ],
    full: "Students studying abroad often develop greater independence and adaptability."
  },
  {
    vn: "Các chính sách giáo dục được thực hiện bởi chính phủ nhằm đảm bảo cơ hội bình đẳng cho mọi người.",
    parts: [
      {en: "Education policies", vn: "chính sách giáo dục", color: "green"},
      {en: "implement", vn: "thực hiện", color: "blue"},
      {en: "equal opportunities", vn: "cơ hội bình đẳng", color: "purple"}
    ],
    full: "Education policies implemented by the government aim to ensure equal opportunities for all."
  },
  {
    vn: "Công nghệ, vốn đang phát triển với tốc độ nhanh, đã thay đổi cách chúng ta giao tiếp.",
    parts: [
      {en: "evolving", vn: "đang phát triển", color: "green"},
      {en: "rapid pace", vn: "tốc độ nhanh", color: "blue"},
      {en: "transform", vn: "thay đổi hoàn toàn", color: "orange"},
    ],
    full: "Technology, evolving at a rapid pace, has transformed the way we communicate."
  },
  {
    vn: "Các công ty cung cấp giờ làm việc linh hoạt có thể cải thiện sự hài lòng của nhân viên.",
    parts: [
      {en: "working hours", vn: "giờ làm việc", color: "green"},
      {en: "employee satisfaction", vn: "sự hài lòng của nhân viên", color: "orange"}
    ],
    full: "Companies providing flexible working hours can improve employee satisfaction."
  },
  {
    vn: "Học sinh, đang đối mặt với áp lực ngày càng tăng từ các kỳ thi, cần được hỗ trợ sức khỏe tâm thần tốt hơn.",
    parts: [
      {en: "face", vn: "đối mặt", color: "green"},
      {en: "increasing pressure", vn: "áp lực ngày càng tăng", color: "blue"},
      {en: "mental health", vn: "sức khỏe tâm thần", color: "orange"},
    ],
    full: "Students, facing increasing pressure from exams, need better mental health support."
  },
  ],

  "Liên từ, Adv nối":[
  {
    vn: "Trong khi nhiều quốc gia đầu tư mạnh vào năng lượng tái tạo, các nước khác vẫn dựa vào nhiên liệu hóa thạch.",
    parts: [
      {en: "renewable energy", vn: "năng lượng tái tạo", color: "orange"},
      {en: "fossil fuels", vn: "nhiên liệu hóa thạch", color: "purple"}
    ],
    full: "While many countries invest heavily in renewable energy, others still rely on fossil fuels."
  },
  {
    vn: "Một số học sinh thích học tập trực tuyến, ngược lại, những học sinh khác thích các lớp học trực tiếp.",
    parts: [
      {en: "online learning", vn: "học tập trực tuyến", color: "blue"},
      {en: "face-to-face classes", vn: "các lớp trực tiếp", color: "orange"}
    ],
    full: "Some students prefer online learning, whereas others enjoy face-to-face classes."
  },
  {
    vn: "Vì chính phủ đã tăng ngân sách cho y tế công cộng, kết quả sức khỏe của người dân đã được cải thiện.",
    parts: [
      {en: "public healthcare", vn: "y tế công cộng", color: "orange"},
      {en: "health outcomes", vn: "kết quả sức khỏe", color: "purple"}
    ],
    full: "Since governments have increased funding for public healthcare, citizens’ health outcomes have improved."
  },
  {
    vn: "Mặc dù công nghệ đã làm cho việc giao tiếp trở nên dễ dàng hơn, nhưng nó cũng gây ra những lo ngại về quyền riêng tư.",
    parts: [
      {en: "simplify", vn: "làm cho đơn giản hơn", color: "blue"},
      {en: "privacy concerns", vn: "lo ngại quyền riêng tư", color: "orange"}
    ],
    full: "Although technology has simplified communication, it has also caused privacy concerns."
  },
  {
    vn: "Nhiều thành phố đã triển khai các chương trình chia sẻ xe đạp bởi vì việc đạp xe giúp giảm tắc nghẽn giao thông.",
    parts: [
      {en: "implement", vn: "triển khai", color: "blue"},
      {en: "bike-sharing schemes", vn: "chương trình chia sẻ xe đạp", color: "orange"},
      {en: "traffic congestion", vn: "tắc nghẽn giao thông", color: "purple"}
    ],
    full: "Many cities have implemented bike-sharing schemes because cycling reduces traffic congestion."
  },
  {
    vn: "Nhiều quốc gia phải đối mặt với những thách thức kinh tế; tuy nhiên, họ vẫn tiếp tục đầu tư vào giáo dục.",
    parts: [
      {en: "economic challenges", vn: "những thách thức kinh tế", color: "blue"},
      {en: "invest in", vn: "đầu tư vào", color: "orange"}
    ],
    full: "Many countries face economic challenges; nevertheless, they continue to invest in education."
  },
  {
    vn: "Chính phủ đã giảm thuế đối với năng lượng tái tạo; do đó, nhiều hộ gia đình có thể mua các tấm pin mặt trời.",
    parts: [
      {en: "renewable energy", vn: "năng lượng tái tạo", color: "blue"},
      {en: "solar panels", vn: "các tấm pin mặt trời", color: "orange"}
    ],
    full: "The government has reduced taxes on renewable energy; therefore, more households can afford solar panels."
  },
  {
    vn: "Dự án rất tốn kém; tuy nhiên, nó đã cải thiện đáng kể dịch vụ y tế công cộng.",
    parts: [
      {en: "public health services", vn: "dịch vụ y tế công cộng", color: "blue"},
    ],
    full: "The project was expensive; however, it significantly improved public health services."
  },
  {
    vn: "Giao thông công cộng tiện lợi; hơn nữa, nó giúp giảm tắc nghẽn giao thông và ô nhiễm.",
    parts: [
      {en: "Public transportation", vn: "Giao thông công cộng", color: "blue"},
      {en: "traffic congestion", vn: "tắc nghẽn giao thông", color: "orange"}
    ],
    full: "Public transportation is convenient; moreover, it reduces traffic congestion and pollution."
  },
  {
    vn: "Thành phố đang phải đối mặt với ô nhiễm không khí nghiêm trọng; thêm vào đó, mức độ tiếng ồn cũng tăng mạnh.",
    parts: [
      {en: "air pollution", vn: "ô nhiễm không khí", color: "blue"},
    ],
    full: "The city faces severe air pollution; in addition, noise levels have increased dramatically."
  },
  ],

  "Rút gọn MĐ Trạng ngữ":[
  {
    vn: "Sau khi hoàn thành khảo sát, học sinh phân tích kết quả.",
    parts: [
      {en: "analyse", vn: "phân tích", color: "orange"},
    ],
    full: "Having completed the survey, students analyzed the results."
  },
  {
    vn: "Tăng ngân sách, chính phủ đã cải thiện hệ thống y tế công cộng.",
    parts: [
      {en: "public healthcare", vn: "y tế công cộng", color: "orange"}
    ],
    full: "Increasing funding, the government has improved public healthcare."
  },
  {
    vn: "Thu thập dữ liệu, các nhà nghiên cứu nhận thấy một số mẫu hình.",
    parts: [
      {en: "patterns", vn: "mẫu hình", color: "purple"}
    ],
    full: "Collecting the data, researchers noticed several patterns."
  },
  {
    vn: "Đã tiến hành nghiên cứu kỹ lưỡng, công ty triển khai chương trình.",
    parts: [
      {en: "extensive research", vn: "nghiên cứu kỹ lưỡng", color: "blue"},
      {en: "launch", vn: "triển khai/ra mắt", color: "orange"}
    ],
    full: "Having conducted extensive research, the company launched the program."
  },
  {
    vn: "Tham gia hội thảo, học sinh học được các kỹ năng giải quyết vấn đề mới.",
    parts: [
      {en: "workshop", vn: "hội thảo", color: "blue"},
      {en: "problem-solving", vn: "giải quyết vấn đề", color: "orange"},
    ],
    full: "Attending the workshop, students learned new problem-solving skills."
  },
  {
    vn: "Cập nhật chương trình học, trường đại học giúp sinh viên có được các kỹ năng thực tiễn.",
    parts: [
      {en: "curriculum", vn: "chương trình học", color: "blue"},
      {en: "practical skills", vn: "kỹ năng thực tiễn", color: "purple"}
    ],
    full: "Updating its curriculum, the university helped students gain practical skills."
  },
  {
    vn: "Sau khi xem xét các báo cáo, các nhà nghiên cứu công bố kết quả nghiên cứu.",
    parts: [
      {en: "publish", vn: "công bố", color: "orange"},
      {en: "findings", vn: "kết quả nghiên cứu", color: "purple"}
    ],
    full: "Having reviewed the reports, researchers published their findings."
  },
  {
    vn: "Thực hiện các chính sách môi trường, chính phủ giảm mức độ ô nhiễm.",
    parts: [
      {en: "environmental policies", vn: "chính sách môi trường", color: "blue"},
      {en: "pollution levels", vn: "mức độ ô nhiễm", color: "purple"}
    ],
    full: "Implementing environmental policies, governments decreased pollution levels."
  },
  {
    vn: "Luyện tập viết luận đều đặn, học sinh cải thiện hiệu quả học tập.",
    parts: [
      {en: "academic performance", vn: "hiệu quả/kết quả học tập", color: "purple"}
    ],
    full: "Practicing writing essays regularly, students improved their academic performance."
  },
  {
    vn: "Áp dụng công nghệ mới, các công ty tăng năng suất.",
    parts: [
      {en: "Adopt", vn: "Áp dụng", color: "green"},
      {en: "productivity", vn: "năng suất", color: "purple"}
    ],
    full: "Adopting new technologies, companies increased productivity."
  },
],


};

let currentTopic = Object.keys(dataByTopic)[0];
let currentIndex = 0;

/* ===== INIT SELECT ===== */
const topicSelect = document.getElementById("topicSelect");
Object.keys(dataByTopic).sort().forEach(topic=>{
  const opt=document.createElement("option"); opt.value=topic; opt.textContent=topic;
  topicSelect.appendChild(opt);
});
topicSelect.value = currentTopic;

/* ===== LOAD CONTENT ===== */
function loadContent(){
  // Grammar
  document.getElementById("grammarContainer").innerText = grammarData[currentTopic];
  document.getElementById("driveFrame").src = driveLinks[currentTopic] || "";

  // Bài tập điền từ
  const box=document.getElementById("exercise");
  box.innerHTML="";
  exercises[currentTopic].forEach((item,i)=>{
    box.innerHTML+=`<div style="margin:10px 0;">${i+1}. ${item.q} <input id="ex${i}"><button onclick="checkEx(${i})">Check</button><span id="resEx${i}" class="result"></span></div>`;
  });

  // Bài tập dịch câu
  loadWriting();
}

/* ===== CHECK EXERCISE ===== */
function checkEx(i){
  const user = document.getElementById("ex"+i).value.trim().toLowerCase();
  const ans = exercises[currentTopic][i].a; // có thể là string hoặc array
  const box = document.getElementById("resEx"+i);

  let correct = false;
  if(Array.isArray(ans)){
    correct = ans.some(a => a.toLowerCase() === user);
  } else {
    correct = user === ans.toLowerCase();
  }

  if(correct){
    box.innerHTML = '<span style="color:green;font-weight:bold;">✔ Correct</span>';
    firework(); // gọi pháo hoa khi đúng
  } else {
    box.innerHTML = '<span style="color:red;font-weight:bold;">✘ ' + (Array.isArray(ans) ? ans.join(" / ") : ans) + '</span>';
  }
}

/* ===== LOAD VIẾT CÂU ===== */
function loadWriting(){
  const item = dataByTopic[currentTopic][currentIndex];
  document.getElementById("vnSentence").innerHTML = item.vn;

  const container = document.getElementById("inputs"); container.innerHTML="";
  item.parts.forEach((p,idx)=>{
    const first=p.en[0], wc=p.en.split(" ").length;
    const hint = `${p.vn} (${first}... ; ${wc} word${wc>1?'s':''})`;
    const row = document.createElement("div");
    row.className="input-row";
    row.innerHTML=`<span class="arrow-icon" style="color:${p.color};">➤</span><input id="box${idx}" placeholder="${hint}"><button onclick="checkWord(${idx})">Check</button><span id="resWord${idx}" class="result"></span>`;
    container.appendChild(row);
    row.querySelector("input").addEventListener("keydown",(e)=>{if(e.key==="Enter"){e.preventDefault(); checkWord(idx);}});
  });

  document.getElementById("fullAnswer").value=""; 
  document.getElementById("fullResult").innerHTML="";
}

/* ===== CHECK WORD ===== */
window.checkWord = function(i){
  const item = dataByTopic[currentTopic][currentIndex];
  const user=document.getElementById("box"+i).value.trim();
  const key=item.parts[i].en; 
  const res=document.getElementById("resWord"+i);

  if(user.toLowerCase()===key.toLowerCase()){
    res.innerHTML = '<span style="color:green;font-weight:bold;">✔ Correct</span>';
    firework(); // gọi pháo hoa khi đúng
  } else {
    res.innerHTML = '<span style="color:red;font-weight:bold;">✘ ' + key + '</span>';
  }
}

/* ===== CHECK FULL SENTENCE ===== */
document.getElementById("submitBtn").onclick=()=>{
  const item = dataByTopic[currentTopic][currentIndex];
  const user=document.getElementById("fullAnswer").value.trim();
  const res=document.getElementById("fullResult");
  if(user.toLowerCase()===item.full.toLowerCase()){
    res.innerHTML='<span class="correct">✔ Correct</span>'; 
    firework(); // gọi pháo hoa
  }
  else{
    res.innerHTML=`<span class="wrong">✘ ${item.full}</span>`;
  }
}

/* ===== NEXT SENTENCE ===== */
document.getElementById("changeBtn").onclick = () => {
  const topicData = dataByTopic[currentTopic];
  
  // Chọn random index khác với currentIndex để tránh lặp ngay lập tức
  let newIndex;
  do {
    newIndex = Math.floor(Math.random() * topicData.length);
  } while (newIndex === currentIndex && topicData.length > 1);

  currentIndex = newIndex;
  loadWriting();
}


/* ===== LOAD INIT ===== */
loadContent();

// ===== ENTER SUBMIT CHO TẤT CẢ INPUT =====
document.addEventListener("keydown", function(e){
  if(e.key === "Enter"){
    const el = document.activeElement;
    
    // Bài tập điền từ
    if(el && el.id.startsWith("ex")){
      const i = parseInt(el.id.replace("ex",""));
      checkEx(i);
      e.preventDefault();
    }

    // Bài tập viết câu (từng từ)
    else if(el && el.id.startsWith("box")){
      const i = parseInt(el.id.replace("box",""));
      checkWord(i);
      e.preventDefault();
    }

    // Bài tập full sentence
    else if(el && el.id === "fullAnswer"){
      document.getElementById("submitBtn").click();
      e.preventDefault();
    }
  }
});


/* ===== SELECT TOPIC ===== */
topicSelect.addEventListener("change",(e)=>{
  currentTopic = e.target.value; currentIndex=0; loadContent();
});

/* ===== ENTER SUBMIT ===== */
document.getElementById("fullAnswer").addEventListener("keydown",(e)=>{
  if(e.key==="Enter"){e.preventDefault(); document.getElementById("submitBtn").click();}
});

/* ===== PHÁO HOA ===== */
function firework() {
  const count = 50; // số lượng pháo hoa
  for (let i = 0; i < count; i++) {
    const conf = document.createElement("div");
    conf.className = "confetti";
    const angle = Math.random() * 2 * Math.PI; // góc bắn
    const radius = 150 + Math.random() * 150;   // bán kính bắn ra
    conf.style.setProperty("--x", Math.cos(angle) * radius + "px");
    conf.style.setProperty("--y", Math.sin(angle) * radius + "px");
    conf.style.backgroundColor = `hsl(${Math.random() * 360}, 90%, 60%)`;
    conf.style.width = conf.style.height = (6 + Math.random() * 6) + "px";
    document.body.appendChild(conf);
    setTimeout(() => conf.remove(), 1200);
  }
}

/* ===== LOAD INIT ===== */
loadContent();
</script>
</body>
</html>
